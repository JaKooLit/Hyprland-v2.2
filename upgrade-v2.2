#!/bin/bash

# Set some colors for output messages
OK="$(tput setaf 2)[OK]$(tput sgr0)"
ERROR="$(tput setaf 1)[ERROR]$(tput sgr0)"
NOTE="$(tput setaf 3)[NOTE]$(tput sgr0)"
WARN="$(tput setaf 166)[WARN]$(tput sgr0)"
CAT="$(tput setaf 6)[ACTION]$(tput sgr0)"
ORANGE=$(tput setaf 166)
YELLOW=$(tput setaf 3)
RESET=$(tput sgr0)

# Set the name of the log file to include the current date and time
LOG="install-$(date +%d-%H%M%S).log"

### Copy Config Files ###
set -e # Exit immediately if a command exits with a non-zero status.

read -n1 -rep "${CAT} Proceed with upgrade? (y,n)" CFG
if [[ $CFG =~ ^[Yy]$ ]]; then

# check for existing config folders and backup 
    for DIR in hypr 
    do 
        DIRPATH=~/.config/$DIR
        if [ -d "$DIRPATH" ]; then 
            echo -e "${NOTE} - Config for $DIR found, attempting to back up."
            cp -r $DIRPATH $DIRPATH-back-up 2>&1 | tee -a "$LOG"
            echo -e "${NOTE} - Backed up $DIR to $DIRPATH-back-up."
        fi

    done

    for DIRw in .themes
    do 
        DIRPATH=~/$DIRw
        if [ -d "$DIRPATH" ]; then 
            echo -e "${NOTE} - themes in $DIRw found, attempting to back up."
            cp -r $DIRPATH $DIRPATH-back-up 2>&1 | tee -a "$LOG"
            echo -e "${NOTE} - Backed up $DIRw to $DIRPATH-back-up."
        fi

    done

    printf " Copying config files...\n"
    mkdir -p ~/.themes
    cp -r themes/* ~/.themes || { echo "Error: Failed to copy hypr config files."; exit 1; } 2>&1 | tee -a "$LOG"
    rm -r ~/.config/hypr/scripts/waybar-style-change || { echo "Error: Failed to delete waybar-style-change."; exit 1; } 2>&1 | tee -a "$LOG"
    rm -r ~/.config/hypr/scripts/layout-switcher || { echo "Error: Failed to delete layout-switcher."; exit 1; } 2>&1 | tee -a "$LOG"
    cp -r hypr ~/.config/ && { echo "Copy completed!"; } || { echo "Error: Failed to copy wallpapers."; exit 1; } 2>&1 | tee -a "$LOG"
    
    # Set some files as executable 
    chmod +x ~/.config/hypr/scripts/dark-light-mode 2>&1 | tee -a "$LOG"
    chmod +x ~/.config/hypr/scripts/layout-switcher 2>&1 | tee -a "$LOG"
    chmod +x ~/.config/hypr/scripts/waybar-style-change 2>&1 | tee -a "$LOG"
else
   print_error " No Config files and wallpaper files copied"
fi

### Script is done ###
printf "\n${OK} Done.\n"
printf "\n"
printf "\n"
read -n1 -rep "${CAT} Would you like to logout (y,n)" HYP

if [[ $HYP =~ ^[Yy]$ ]]; then
        hyprctl dispatch exit
 else
     exit
fi


